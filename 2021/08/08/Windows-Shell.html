<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Windows shell</title>
    <script type="text/javascript" src="/assets/js/prism.js"></script>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <script type="text/javascript" src="/assets/js/jquery-3.6.0.js"></script>
    <script src="/assets/js/scrollnav.min.umd.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <div class="clearfloat">
        <nav class="navbar">
    <!-- <a href="/" >
        Home
    </a>
    <a href="/about.html" >
        About
    </a> -->
    
        <!-- <a href="https://github.com/Zhniing"  target="_self"> -->
        <a href="https://github.com/Zhniing" target="_blank">
            Github
        </a>
    
        <!-- <a href="/about.html"  target="_self"> -->
        <a href="/about.html" target="_self">
            About
        </a>
    
        <!-- <a href="/games/hiker"  target="_self"> -->
        <a href="/games/hiker" target="_self">
            Game
        </a>
    
        <!-- <a href="/"  target="_self"> -->
        <a href="/" target="_self">
            Home
        </a>
    
</nav>
      </div>
      <base target="_blank"> <!-- 仅post页面的a标签为_blank -->

<h1>Windows shell</h1>
<!-- <p>Posted on 08 Aug 2021, Last updated: </p> -->
<!-- <p>发表于 2021 年 08 月 08 日 | 更新于 </p> -->
<p>发布于 2021 年 08 月 08 日  | 更新于 2022 年 01 月 11 日 </p>

<div class="post_content">
    <h1 id="dos--cmd">DOS &amp; CMD</h1>

<ul>
  <li>
    <p>DOS: The <strong>operating system</strong>.</p>
  </li>
  <li>
    <p>CMD: The <strong>shell</strong> that allows you to enter your commands to perform your tasks.</p>
  </li>
</ul>

<p><a href="https://qr.ae/pGkDIh">ref</a></p>

<h1 id="创建文件">创建文件</h1>

<p><code class="language-plaintext highlighter-rouge">copy con [file_name]</code>从标准输入新建文件，<code class="language-plaintext highlighter-rouge">Ctrl+Z</code>结束输入（<code class="language-plaintext highlighter-rouge">copy con</code>特有的用法）</p>

<h1 id="cmd">CMD</h1>

<p>cmd中，命令的<strong>参数</strong>叫做<strong>开关switch</strong>，写为：斜杠<code class="language-plaintext highlighter-rouge">/</code>+单个字母，不像Linux用短线<code class="language-plaintext highlighter-rouge">-</code></p>

<p>cmd中，命令、开关和环境变量<strong>大小写不敏感</strong>，大写小写是同一个指令</p>

<p><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/for">Windows commands官方文档</a></p>

<h2 id="内部命令--外部命令">内部命令 &amp; 外部命令</h2>

<p>内部命令是集成在<code class="language-plaintext highlighter-rouge">cmd.exe</code>中的命令，任何时候都可以执行，例如<code class="language-plaintext highlighter-rouge">cd</code>，<code class="language-plaintext highlighter-rouge">cls</code></p>

<p>外部命令是存储在磁盘上的可执行文件，大多存放在<code class="language-plaintext highlighter-rouge">C:\Windows\System32</code>，通常以<code class="language-plaintext highlighter-rouge">.com</code>或<code class="language-plaintext highlighter-rouge">.exe</code>为后缀，如<code class="language-plaintext highlighter-rouge">ping.exe</code></p>

<p><a href="http://cis2.oc.ctc.edu/oc_apps/Westlund/xbook/xbook.php?unit=05&proc=page&numb=5">Internal and External Commands</a></p>

<h2 id="常用命令">常用命令</h2>

<p><code class="language-plaintext highlighter-rouge">help</code>：帮助文档，类似于Linux的<code class="language-plaintext highlighter-rouge">man</code>：</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">help</span> <span class="o">[</span><span class="kd">command</span><span class="o">]</span>
<span class="o">[</span><span class="kd">command</span><span class="o">]</span> /<span class="o">?</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">findstr</code>：<code class="language-plaintext highlighter-rouge">grep</code></p>

<p><code class="language-plaintext highlighter-rouge">ren</code>/<code class="language-plaintext highlighter-rouge">rename</code>：重命名文件</p>

<p><code class="language-plaintext highlighter-rouge">rmdir</code>：删除<strong>空</strong>文件夹，<code class="language-plaintext highlighter-rouge">/S</code>递归删除，可以删除非空文件夹；<code class="language-plaintext highlighter-rouge">/Q</code>不需要确认(<em>quiet</em>)</p>

<p><code class="language-plaintext highlighter-rouge">choice</code>：通过<code class="language-plaintext highlighter-rouge">%errorlevel%</code>获取用户输入的结果，第一个选项为<code class="language-plaintext highlighter-rouge">1</code>，依次递增</p>

<p><code class="language-plaintext highlighter-rouge">type</code>：显示文本文件的内容，Linux<code class="language-plaintext highlighter-rouge">cat</code>？</p>

<p><code class="language-plaintext highlighter-rouge">cls</code>：清屏<em>clear</em></p>

<p><code class="language-plaintext highlighter-rouge">copy</code>：合并文件</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">copy</span> <span class="kd">a</span>.jpg <span class="na">/b </span><span class="o">+</span> <span class="kd">b</span>.txt <span class="na">/a </span><span class="kd">c</span>.jpg

# <span class="na">/b </span>二进制格式，接在文件后面
# <span class="na">/a </span><span class="kd">ASCII</span>码格式，接在文件后面
# <span class="kd">c</span>.jpg 合并后的文件名

<span class="nb">copy</span> <span class="na">/b </span><span class="kd">a</span>.mpg <span class="o">+</span> <span class="kd">b</span>.jpg <span class="kd">c</span>.mpg

# <span class="na">/b </span>写在最前面，指定所有文件的格式
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">tree</code>：以树状结构打印目录，<code class="language-plaintext highlighter-rouge">-f</code>显示子目录中的内容</p>

<p><code class="language-plaintext highlighter-rouge">call &lt;.cmd|.bat&gt;</code>：类似于<code class="language-plaintext highlighter-rouge">source .bashrc</code>，刷新配置（如：环境变量）</p>

<h2 id="脚本">脚本</h2>

<p>脚本后缀为<code class="language-plaintext highlighter-rouge">.bat</code>或<code class="language-plaintext highlighter-rouge">.cmd</code></p>

<p>手册/教程：</p>

<ul>
  <li><a href="https://ss64.com/nt/">ss64 cmd</a></li>
  <li><a href="https://www.tacktech.com/display.cfm?ttid=307">tacktect: Batch Guide</a></li>
  <li><a href="https://www.tutorialspoint.com/batch_script/index.htm">Batch Script Tutorial</a></li>
</ul>

<h3 id="命令回显">命令回显</h3>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="o">[</span><span class="na">on</span><span class="o">|</span><span class="na">off</span><span class="o">]</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">echo</code>表示接下来的是否打印（回显）命令本身，前面的<code class="language-plaintext highlighter-rouge">@</code>表示这条命令本身不回显</p>

<h3 id="注释">注释</h3>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">@REM 这里是注释，推荐这种方式</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">REM</code>表示后面的命令不会被执行，但会回显；加<code class="language-plaintext highlighter-rouge">@</code>设置不回显</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">:: 这里是注释，不提倡通过label(:)设置注释</span>
</code></pre></div></div>

<p>双冒号<code class="language-plaintext highlighter-rouge">::</code>，本质上是永远不会被跳转到的<code class="language-plaintext highlighter-rouge">label</code>，<strong>不会回显</strong>。</p>

<p><code class="language-plaintext highlighter-rouge">label</code>所在的行不会被执行，理论上单冒号也能写注释吧？</p>

<h3 id="变量">变量</h3>

<h4 id="环境变量">环境变量</h4>

<p>查看现有环境变量<code class="language-plaintext highlighter-rouge">set</code></p>

<p>设置环境变量<code class="language-plaintext highlighter-rouge">set [&lt;variable&gt;=[&lt;string&gt;]]</code>，等号<code class="language-plaintext highlighter-rouge">=</code>两边不能有空格，参数如下：</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/p</code>：打印提示(<em>prompt</em>)，将用户输入存入变量</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/a</code>：将<code class="language-plaintext highlighter-rouge">&lt;string&gt;</code>当作<strong>数值表达式</strong>计算（可以<code class="language-plaintext highlighter-rouge">+=</code>），结果存入变量。这个表达式中，<code class="language-plaintext highlighter-rouge">+</code>和<code class="language-plaintext highlighter-rouge">-</code>只是用来算操作数的正负号的，可以负负<code class="language-plaintext highlighter-rouge">--</code>得正</p>

    <div class="language-batch highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kd">C</span>:\&gt;set <span class="kd">a</span><span class="o">=</span><span class="m">1</span>
<span class="kd">C</span>:\&gt;set <span class="na">/a </span><span class="kd">a</span><span class="o">+=</span><span class="m">1</span>
<span class="m">2</span>

<span class="kd">C</span>:\&gt;set <span class="na">/a </span><span class="kd">a</span><span class="o">=</span><span class="m">1</span><span class="o">+</span><span class="m">1</span>
<span class="m">2</span>
<span class="kd">C</span>:\&gt;set <span class="na">/a </span><span class="kd">a</span><span class="o">=</span><span class="m">1</span><span class="o">--</span><span class="m">1</span>
<span class="m">2</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>调用全局变量：<code class="language-plaintext highlighter-rouge">%a%</code>，局部变量<code class="language-plaintext highlighter-rouge">!a!</code></p>

<h4 id="变量的运作方式">变量的运作方式</h4>

<p>脚本是<strong>逐语句</strong>执行的，一条复杂语句可能有多行简单语句组成（如<code class="language-plaintext highlighter-rouge">for</code>语句），cmd每次把一条最外层的<strong>语句</strong>加载到内存中，并进行<strong>预处理</strong>：把语句中所有变量<code class="language-plaintext highlighter-rouge">%a%</code>替换成环境变量（感觉像C语言的<strong>宏替换</strong><img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" raw="😅" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" style="vertical-align: middle; display: inline; max-width: 1em; visibility: hidden;" onload="this.style.visibility='visible'" onerror="this.replaceWith(this.getAttribute('raw'))">）。这样所有的变量就变成了字符串常量（可以理解成写死到代码里了）。如果执行过程中修改了环境变量<code class="language-plaintext highlighter-rouge">%a%</code>，（<strong>该语句中</strong>）后面引用的<code class="language-plaintext highlighter-rouge">%a%</code>值也不会改变，因为<code class="language-plaintext highlighter-rouge">%a%</code>在语句执行前就已经被替换成字符串常量了。只有在后面的<strong>语句</strong>中，才能引用到修改后的变量<code class="language-plaintext highlighter-rouge">%a%</code></p>

<p>这种现象叫做<strong><em>变量延迟</em></strong>，代码如下：</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="kd">set</span> <span class="kd">a</span><span class="o">=</span><span class="m">1</span>
<span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">+=</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">%a%</span>
<span class="k">for</span> <span class="na">/l </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">1</span><span class="o">,</span> <span class="m">3</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
    <span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">+=</span><span class="m">1</span>
    <span class="nb">echo</span> <span class="nv">%a%</span>
<span class="o">)</span>
</code></pre></div></div>

<p>执行结果为：</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span>
<span class="m">2</span>
<span class="m">2</span>
<span class="m">2</span>
</code></pre></div></div>

<p>防止<strong><em>变量延迟</em></strong>的方法：</p>

<p>在使用变量之<strong>前</strong>（具体位置随意），执行<code class="language-plaintext highlighter-rouge">setlocal EnableDelayedExpansion</code>，并且使用<strong>感叹号</strong><code class="language-plaintext highlighter-rouge">!a!</code>调用延迟变量</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="nb">setlocal</span> <span class="kd">EnableDelayedExpansion</span>
<span class="kd">set</span> <span class="kd">a</span><span class="o">=</span><span class="m">1</span>
<span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">+=</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">!a!</span>
<span class="k">for</span> <span class="na">/l </span><span class="vm">%%i</span> <span class="k">in</span> <span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">1</span><span class="o">,</span> <span class="m">3</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
    <span class="kd">set</span> <span class="na">/a </span><span class="kd">a</span><span class="o">+=</span><span class="m">1</span>
    <span class="nb">echo</span> <span class="nv">!a!</span>
<span class="o">)</span>
</code></pre></div></div>

<h4 id="局部变量">局部变量</h4>

<p><code class="language-plaintext highlighter-rouge">setlocal</code>和<code class="language-plaintext highlighter-rouge">endlocal</code>声明了一个局部作用域，在里面定义的环境变量<code class="language-plaintext highlighter-rouge">b</code>，会在<code class="language-plaintext highlighter-rouge">endlocal</code>时被<strong>销毁</strong></p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">setlocal</span>
<span class="kd">set</span> <span class="kd">b</span><span class="o">=</span><span class="m">1</span>
<span class="kd">set</span> <span class="o">|</span> <span class="nb">findstr</span> <span class="kd">b</span><span class="o">=</span><span class="m">1</span>
<span class="nb">echo</span> <span class="kd">b</span> <span class="nv">%b%</span>
<span class="nb">endlocal</span>
<span class="kd">set</span> <span class="o">|</span> <span class="nb">findstr</span> <span class="kd">b</span><span class="o">=</span><span class="m">1</span>
<span class="nb">echo</span> <span class="kd">b</span> <span class="nv">%b%</span>
</code></pre></div></div>

<h3 id="引号">引号</h3>

<p>bat脚本<strong>仅</strong>在for循环的内容中使用<strong>单引号</strong>：<code class="language-plaintext highlighter-rouge">for /f %%a in ('someCommand or string') do (...)</code></p>

<p>其余都是双引号</p>

<p><strong>含空格</strong>的字符串可以用<strong>双引号</strong>包起来<code class="language-plaintext highlighter-rouge">echo "this is xxx"</code>，连续字符串可以不用引号<code class="language-plaintext highlighter-rouge">echo abcdef</code></p>

<p><a href="http://teaching.idallen.com/cst8207/13w/notes/440_quotes.html">shell吞引号问题</a></p>

<p>cmd变量是宏替换，所以尽量不要在引号外面套引号，可能会出现奇怪的bug<img class="emoji" title=":clown_face:" alt=":clown_face:" raw="🤡" src="https://github.githubassets.com/images/icons/emoji/unicode/1f921.png" style="vertical-align: middle; display: inline; max-width: 1em; visibility: hidden;" onload="this.style.visibility='visible'" onerror="this.replaceWith(this.getAttribute('raw'))"></p>

<h3 id="值比较">值比较</h3>

<p><code class="language-plaintext highlighter-rouge">&amp; rem</code>表示行尾注释</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">set</span> <span class="kd">str_quote</span><span class="o">=</span><span class="s2">"aaa"</span>
<span class="kd">set</span> <span class="kd">str</span><span class="o">=</span><span class="kd">aaa</span>

<span class="k">if</span>  <span class="nv">%str_quote%</span>  <span class="o">==</span> <span class="s2">"aaa"</span> <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem eq</span>
<span class="k">if</span> <span class="s2">"</span><span class="nv">%str_quote%</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"aaa"</span> <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem not eq</span>
<span class="k">if</span>  <span class="nv">%str_quote%</span>  <span class="o">==</span>  <span class="kd">aaa</span>  <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem not eq</span>
<span class="k">if</span> <span class="s2">"</span><span class="nv">%str_quote%</span><span class="s2">"</span> <span class="o">==</span>  <span class="kd">aaa</span>  <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem not eq</span>
<span class="k">if</span>  <span class="nv">%str%</span>  <span class="o">==</span> <span class="s2">"aaa"</span> <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem not eq</span>
<span class="k">if</span> <span class="s2">"</span><span class="nv">%str%</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"aaa"</span> <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem eq</span>
<span class="k">if</span>  <span class="nv">%str%</span>  <span class="o">==</span>  <span class="kd">aaa</span>  <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem eq</span>
<span class="k">if</span> <span class="s2">"</span><span class="nv">%str%</span><span class="s2">"</span> <span class="o">==</span>  <span class="kd">aaa</span>  <span class="o">(</span><span class="nb">echo</span> <span class="kd">eq</span><span class="o">)</span> <span class="k">else</span> <span class="o">(</span><span class="nb">echo</span> <span class="ow">not</span> <span class="kd">eq</span><span class="o">)</span> <span class="o">&amp;</span> <span class="c">rem not eq</span>
</code></pre></div></div>

<p>感觉字符串变量像是<strong>宏替换</strong>？只在都有引号或都没引号时相等</p>

<h3 id="errorlevel">errorlevel</h3>

<p>一条命令执行完后都会有一个返回值<em>errorlevel</em>，<strong>0</strong>表示执行<strong>成功</strong>，其他表示各种错误 <a href="https://www.tutorialspoint.com/batch_script/batch_script_return_code.htm">ref</a></p>

<p>通过变量<code class="language-plaintext highlighter-rouge">%errorlevel%</code>查看上一条指令的返回值</p>

<h3 id="命令连接符">命令连接符</h3>

<h4 id="-和-">&amp;&amp; 和 ||</h4>

<p>连接两条指令，依据第一条指令返回的<code class="language-plaintext highlighter-rouge">errorlevel</code>，进行与<code class="language-plaintext highlighter-rouge">&amp;&amp;</code>和或<code class="language-plaintext highlighter-rouge">||</code>的<strong>短路</strong>运算</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">C</span>:\&gt;cd <span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="m">2</span>
系统找不到指定的路径。

<span class="kd">C</span>:\&gt;cd <span class="m">1</span> <span class="o">||</span> <span class="nb">echo</span> <span class="m">2</span>
系统找不到指定的路径。
<span class="m">2</span>
</code></pre></div></div>

<h4>&amp;</h4>

<p>连接两条命令，<strong>顺序</strong>执行</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">C</span>:\&gt;echo <span class="kd">hello</span> <span class="o">&amp;</span> <span class="nb">echo</span> <span class="kd">world</span>
<span class="kd">hello</span>
<span class="kd">world</span>
</code></pre></div></div>

<h4 id="-1">|</h4>

<p><strong>管道</strong>：前一条命令的标准输出作为后一条命令的输入</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">C</span>:\&gt;dir <span class="o">|</span> <span class="nb">findstr</span> <span class="na">-i </span><span class="kd">program</span>
<span class="m">2021</span>/06/23  <span class="m">22</span>:56    <span class="o">&lt;</span><span class="kd">DIR</span><span class="o">&gt;</span>          <span class="kd">Program</span> <span class="kd">Files</span>
<span class="m">2021</span>/06/23  <span class="m">22</span>:50    <span class="o">&lt;</span><span class="kd">DIR</span><span class="o">&gt;</span>          <span class="kd">Program</span> <span class="kd">Files</span> <span class="o">(</span><span class="kd">x86</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="for">for</h3>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">{</span> <span class="err">%%</span> <span class="o">|</span> <span class="err">%</span> <span class="o">}&lt;</span><span class="kd">variable</span><span class="o">&gt;</span> <span class="k">in</span> <span class="o">(&lt;</span><span class="kd">set</span><span class="o">&gt;)</span> <span class="k">do</span> <span class="o">(</span>
    <span class="o">&lt;</span><span class="kd">command</span><span class="o">&gt;</span> <span class="o">[&lt;</span><span class="kd">commandlineoptions</span><span class="o">&gt;]</span>
<span class="o">)</span>
</code></pre></div></div>

<p>for循环替代变量：bat脚本中用双引号<code class="language-plaintext highlighter-rouge">%%a</code>，cmd交互式命令中用单引号<code class="language-plaintext highlighter-rouge">%a</code></p>

<p><code class="language-plaintext highlighter-rouge">&lt;set&gt;</code>：多个对象之间用<strong>空格分隔</strong>，依次执行for，而<strong>不是同时</strong>for所有对象</p>

<h4 id="命令扩展参数选项">命令扩展（参数选项）</h4>

<p>在关键字<code class="language-plaintext highlighter-rouge">for</code>后添加如下参数</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">for /f ["options"]</code>：<strong>逐行</strong>遍历文件</p>

    <p><code class="language-plaintext highlighter-rouge">"options"</code>如下：</p>

    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">"tokens=1,3"</code>：对于每行文件，获取第<code class="language-plaintext highlighter-rouge">1</code>和第<code class="language-plaintext highlighter-rouge">3</code>项，默认分隔符为<em>空格</em>或<em>制表符tab</em>
</li>
      <li>
<code class="language-plaintext highlighter-rouge">"delims=,|"</code>：自定义分隔符<code class="language-plaintext highlighter-rouge">,</code>或<code class="language-plaintext highlighter-rouge">|</code>
</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">for /r [[drive:]path]</code>：递归遍历文件夹</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">&lt;set&gt;</code>此时还可以是文件（可多个）、命令（仅一条）</p>

<p><code class="language-plaintext highlighter-rouge">%%~a</code>：去掉变量a最外层的引号</p>

<p><code class="language-plaintext highlighter-rouge">%%~na</code>：<strong>不含后缀</strong>的文件名，也会去掉外层引号</p>

<h3 id="goto">goto</h3>

<p>冒号<code class="language-plaintext highlighter-rouge">:</code>开头的行都会被视为标签<code class="language-plaintext highlighter-rouge">label</code>，执行goto语句可以跳转到指定的<code class="language-plaintext highlighter-rouge">label</code></p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">goto</span> <span class="kd">a1</span>
这里随便写
不会被执行
可以用来写注释？
<span class="nl">:a</span><span class="m">1</span>
<span class="nb">echo</span> <span class="kd">a1</span>
</code></pre></div></div>

<p>但只有<strong>数字和字母开头</strong>（不管后面有什么怪符号）的<code class="language-plaintext highlighter-rouge">label</code>可以被goto语句识别，所以其他符号开头的<code class="language-plaintext highlighter-rouge">label</code>由于永远不会被跳转，所以可以写成注释（<em>不提倡</em>）</p>

<h3 id="数组">数组</h3>

<p>假数组<img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" raw="😅" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" style="vertical-align: middle; display: inline; max-width: 1em; visibility: hidden;" onload="this.style.visibility='visible'" onerror="this.replaceWith(this.getAttribute('raw'))"></p>

<h3 id="小技巧">小技巧</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pause</code>：暂停脚本，并打印<code class="language-plaintext highlighter-rouge">请按任意键继续. . . </code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">title</code>：设置窗口（黑框框）标题</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mode </code>：</p>

    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">mode con cols=15 lines=20</code>：设置窗口大小</li>
    </ul>
  </li>
  <li>
    <p>打印包含特殊字符的字符串：<strong>转义</strong>符<code class="language-plaintext highlighter-rouge">^</code></p>

    <div class="language-batch highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">setlocal</span> <span class="kd">EnableDelayedExpansion</span>
<span class="kd">SET</span> <span class="s2">"msg=There are no archives to convert</span><span class="se">^!</span><span class="s2">"</span>
<span class="kd">ECHO</span> <span class="nv">!msg!</span>
</code></pre></div>    </div>

    <p>如果只打印感叹号<code class="language-plaintext highlighter-rouge">!</code>，还可以禁用延迟扩展<code class="language-plaintext highlighter-rouge">DisableDelayedExpansion</code>，来避免<code class="language-plaintext highlighter-rouge">!</code>被当成特殊符号：</p>

    <div class="language-batch highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">setlocal</span> <span class="kd">DisableDelayedExpansion</span>
<span class="kd">ECHO</span>: <span class="o">&amp;</span> <span class="kd">ECHO</span> <span class="kd">xxxxxx</span><span class="err">!</span>
<span class="nb">endlocal</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>自定义<code class="language-plaintext highlighter-rouge">PAUSE</code>的提示文本</p>

    <div class="language-batch highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kd">ECHO</span> <span class="kd">Press</span> <span class="kd">any</span> <span class="kd">key</span> <span class="kd">to</span> <span class="kd">EXIT</span>... <span class="o">&amp;&amp;</span> <span class="kd">PAUSE</span> <span class="o">&gt;</span> <span class="kr">nul</span> <span class="o">&amp;&amp;</span> <span class="kd">EXIT</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>判断变量<code class="language-plaintext highlighter-rouge">a</code>是否为空，注意<code class="language-plaintext highlighter-rouge">defined</code>后的变量<strong>不用加双引号</strong><code class="language-plaintext highlighter-rouge">%a%</code></p>

    <div class="language-batch highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="ow">defined</span> <span class="kd">a</span> <span class="nb">echo</span> <span class="ow">not</span> <span class="kd">null</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>打印空行</p>

    <p><a href="https://stackoverflow.com/questions/132799/how-can-i-echo-a-newline-in-a-batch-file#comment51324419_132811">How can I echo a newline in a batch file?</a></p>

    <div class="language-batch highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kd">C</span>:\&gt;echo <span class="kd">hello</span> <span class="o">&amp;</span> <span class="nb">echo</span>: <span class="o">&amp;</span> <span class="nb">echo</span> <span class="kd">batch</span>
<span class="kd">hello</span>

<span class="kd">batch</span>
</code></pre></div>    </div>

    <p><code class="language-plaintext highlighter-rouge">echo:</code>是什么原理啊？<img class="emoji" title=":astonished:" alt=":astonished:" raw="😲" src="https://github.githubassets.com/images/icons/emoji/unicode/1f632.png" style="vertical-align: middle; display: inline; max-width: 1em; visibility: hidden;" onload="this.style.visibility='visible'" onerror="this.replaceWith(this.getAttribute('raw'))"></p>

    <p>冒号还可以换成其他分隔符<code class="language-plaintext highlighter-rouge">. , / \</code>，但都可能引发奇怪的bug：<a href="https://ss64.com/nt/echo.html">ss64 - Echo - Echo a blank line</a></p>
  </li>
</ul>

<h3 id="实战">实战</h3>

<p>压缩包格式转换：Rar5 -&gt; 7z</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@ECHO <span class="na">off</span>
<span class="c">@REM rar_to_7z.bat</span>
<span class="nb">setlocal</span> <span class="kd">EnableDelayedExpansion</span>

<span class="c">@REM 设置archives为空</span>
<span class="kd">SET</span> <span class="kd">archives</span><span class="o">=</span>
<span class="c">@REM 遍历当前文件夹下的所有7z</span>
<span class="kd">ECHO</span> <span class="kd">Finding</span> <span class="kd">Rar5</span> <span class="kd">archives</span> <span class="k">in</span> <span class="kd">current</span> <span class="kd">directory</span> ... <span class="o">&amp;</span> <span class="kd">ECHO</span>:
<span class="k">for</span> <span class="na">/f </span><span class="s2">"delims="</span> <span class="vm">%%f</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'dir /b *.7z'</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
    <span class="c">@REM 检查压缩文件类型</span>
    <span class="k">for</span> <span class="na">/f </span><span class="s2">"tokens=1,3"</span> <span class="vm">%%a</span> <span class="k">in</span> <span class="o">(</span><span class="s1">'7z t "</span><span class="vm">%%f</span><span class="s1">"'</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
        <span class="c">@REM 查找Rar5压缩包</span>
        <span class="k">if</span> <span class="vm">%%a</span> <span class="o">==</span> <span class="kd">Type</span> <span class="k">if</span> <span class="vm">%%b</span> <span class="o">==</span> <span class="kd">Rar5</span> <span class="o">(</span>
            <span class="kd">ECHO</span> <span class="vm">%%f</span>: <span class="kd">Type</span> <span class="o">=</span> <span class="vm">%%b</span>
            <span class="kd">SET</span> <span class="kd">archives</span><span class="o">=</span><span class="nv">!archives!</span> <span class="s2">"</span><span class="vm">%%f</span><span class="s2">"</span>
        <span class="o">)</span>
    <span class="o">)</span>
<span class="o">)</span>

<span class="c">@REM 判断archives是否为空</span>
<span class="k">if</span> <span class="ow">not</span> <span class="ow">defined</span> <span class="kd">archives</span> <span class="o">(</span>
    <span class="kd">SET</span> <span class="s2">"msg=There are no archives to convert</span><span class="se">^!</span><span class="s2">"</span>
    <span class="kd">ECHO</span> <span class="nv">!msg!</span>
    <span class="kd">ECHO</span> <span class="kd">Press</span> <span class="kd">any</span> <span class="kd">key</span> <span class="kd">to</span> <span class="kd">EXIT</span>...
    <span class="kd">PAUSE</span> <span class="o">&gt;</span> <span class="kr">nul</span>
    <span class="kd">EXIT</span>
<span class="o">)</span>

<span class="kd">CHOICE</span> <span class="na">/m </span><span class="s2">"Convert the above archives to 7z?"</span>
<span class="k">if</span> <span class="nv">%errorlevel%</span> <span class="o">==</span> <span class="m">2</span> <span class="kd">EXIT</span>

<span class="c">@REM 执行转换</span>
<span class="c">@REM 遍历archives，默认以空格分隔</span>
<span class="k">for</span> <span class="vm">%%a</span> <span class="k">in</span> <span class="o">(</span><span class="nv">%archives%</span><span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
    <span class="c">@REM 解压到文件夹</span>
    <span class="m">7</span><span class="kd">z</span> <span class="kd">x</span> <span class="vm">%%a</span> <span class="na">-o</span><span class="vm">%%a</span>.contents
    <span class="c">@REM 重新压缩成7z</span>
    <span class="kd">CD</span> <span class="vm">%%a</span>.contents
    <span class="m">7</span><span class="kd">z</span> <span class="kd">a</span> <span class="na">-t</span><span class="m">7</span><span class="kd">z</span> ..\<span class="s2">"</span><span class="vm">%%~na</span><span class="s2">"</span>.7z.tmp <span class="o">*</span>
    <span class="kd">CD</span> ..
    <span class="c">@REM 删除解压的临时文件夹</span>
    <span class="kd">RMDIR</span> <span class="na">/S /Q </span><span class="vm">%%a</span>.contents
    <span class="c">@REM 重命名原压缩包和新压缩包</span>
    <span class="kd">REN</span> <span class="vm">%%a</span> <span class="vm">%%a</span>.bak
    <span class="kd">REN</span> <span class="s2">"</span><span class="vm">%%~na</span><span class="s2">"</span>.7z.tmp <span class="s2">"</span><span class="vm">%%~na</span><span class="s2">"</span>.7z
<span class="o">)</span>

<span class="c">@REM 打印转换前的压缩包</span>
<span class="kd">ECHO</span>: <span class="o">&amp;</span> <span class="kd">ECHO</span> <span class="kd">The</span> <span class="kd">previous</span> <span class="kd">archives</span> <span class="kd">have</span> <span class="kd">been</span> <span class="kd">renamed</span> <span class="kd">to</span> <span class="o">*</span>.bak:
<span class="kd">DIR</span> <span class="na">/b </span><span class="o">*</span>.bak
<span class="c">@REM 询问是否删除原压缩包</span>
<span class="kd">CHOICE</span> <span class="na">/m </span><span class="s2">"Delete the previous archives(*.bak)?"</span>
<span class="k">if</span> <span class="nv">%errorlevel%</span> <span class="o">==</span> <span class="m">1</span> <span class="kd">DEL</span> <span class="o">*</span>.bak

<span class="nb">setlocal</span> <span class="kd">DisableDelayedExpansion</span>
<span class="kd">ECHO</span>: <span class="o">&amp;</span> <span class="kd">ECHO</span> <span class="kd">Conversion</span> <span class="kd">completed</span><span class="err">!</span>
<span class="nb">endlocal</span>
<span class="kd">ECHO</span> <span class="kd">Press</span> <span class="kd">any</span> <span class="kd">key</span> <span class="kd">to</span> <span class="kd">EXIT</span>... <span class="o">&amp;&amp;</span> <span class="kd">PAUSE</span> <span class="o">&gt;</span> <span class="kr">nul</span>
</code></pre></div></div>

<p><a href="http://aarmstrong.org/tutorials/mass-zip-rar-to-7zip-recompression-batch-file">MASS ZIP, RAR TO 7ZIP RECOMPRESSION BATCH FILE</a></p>

<h1 id="powershell">PowerShell</h1>

<p>脚本后缀<code class="language-plaintext highlighter-rouge">.ps1</code></p>

<h1 id="cmder">Cmder</h1>

<p>更现代化的CMD替代品，移植了部分linux命令</p>

<p>Cmder安装后都要在环境变量中配置<strong>根目录</strong>：<code class="language-plaintext highlighter-rouge">%CMDER_ROOT%</code></p>

<p><code class="language-plaintext highlighter-rouge">Win+R</code>输入<code class="language-plaintext highlighter-rouge">%CMDER_ROOT%</code>直接打开文件夹</p>

</div>
    </div>
    <script>
      const ct = document.querySelector('.post_content');  //".post-content"指向文章内容所在的div，需根据实际情况修改
      scrollnav.init(ct, {
          debug: false,
          easingStyle: 'linear',
          //section为一级目录，subsection为二级目录
          sections: ($('.post_content > h1').length>0) ? 'h1' : 'h2',
          subSections: ($('.post_content > h1').length>0) ? 'h2' : 'h3',
      });
    </script>
    <script type="text/javascript">
      $('pre').addClass("line-numbers").css("white-space", "pre-wrap");
    </script>
  </body>
</html>
