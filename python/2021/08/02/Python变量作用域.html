<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Python变量作用域</title>
    <script type="text/javascript" src="/assets/js/prism.js"></script>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <script type="text/javascript" src="/assets/js/jquery-3.6.0.js"></script>
    <script src="/assets/js/scrollnav.min.umd.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <div class="clearfloat">
        <nav class="navbar">
    <!-- <a href="/" >
        Home
    </a>
    <a href="/about.html" >
        About
    </a> -->
    
        <!-- <a href="https://github.com/Zhniing"  target="_self"> -->
        <a href="https://github.com/Zhniing" target="_blank">
            Github
        </a>
    
        <!-- <a href="/about.html"  target="_self"> -->
        <a href="/about.html" target="_self">
            About
        </a>
    
        <!-- <a href="/games/hiker"  target="_self"> -->
        <a href="/games/hiker" target="_self">
            Game
        </a>
    
        <!-- <a href="/"  target="_self"> -->
        <a href="/" target="_self">
            Home
        </a>
    
</nav>
      </div>
      <base target="_blank"> <!-- 仅post页面的a标签为_blank -->

<h1>Python变量作用域</h1>
<!-- <p>Posted on 02 Aug 2021, Last updated: </p> -->
<!-- <p>发表于 2021 年 08 月 02 日 | 更新于 </p> -->
<p>发布于 2021 年 08 月 02 日  | 更新于 2021 年 08 月 17 日 </p>

<div class="post_content">
    <h1 id="名字-symbolic-name">名字 symbolic name</h1>

<blockquote>
  <p>An <strong>assignment statement</strong> creates a <strong>symbolic name</strong> that you can use to reference an object. The statement <code class="language-plaintext highlighter-rouge">x = 'foo'</code> creates a symbolic name <code class="language-plaintext highlighter-rouge">x</code> that refers to the <a href="https://realpython.com/python-strings/">string</a> object <code class="language-plaintext highlighter-rouge">'foo'</code>.</p>
</blockquote>

<h1 id="命名空间-namespaces">命名空间 Namespaces</h1>

<blockquote>
  <p>A namespace is a collection of currently defined symbolic names along with information about the object that each name references. You can think of a namespace as a <a href="https://realpython.com/python-dicts">dictionary</a> in which the keys are the object names and the values are the objects themselves. Each key-value pair maps a name to its corresponding object.</p>
</blockquote>

<p>命名空间是一组<em>名字及其所指对象</em>的容器，可理解成字典，名字为键(key)，对象为值(value)</p>

<p>在一个命名空间中，名字是唯一的，而不同命名空间中可以有相同名字</p>

<p>不同的命名空间把<em>相同名字</em>的<em>不同对象</em>隔开，解决了名字<strong>冲突</strong>的问题</p>

<h1 id="变量作用域-variable-scope">变量作用域 Variable Scope</h1>

<blockquote>
  <p>The existence of multiple, distinct namespaces means several different instances of a particular name can exist simultaneously while a Python program runs. As long as each instance is in a different namespace, they’re all maintained separately and won’t interfere with one another.</p>
</blockquote>

<p>命名空间解决了<strong>名字冲突</strong>的问题，而变量作用域则规定了<strong>查找名字</strong>的规则<em>LEGB</em>（从哪个命名空间中查找名字），划分了访问名字的<strong>权限</strong>（外部作用域无法访问内部作用域的名字）</p>

<p>我感觉<em>命名空间和变量作用域在很多时候是一个意思</em>，<strong>那到底有什么区别呢？</strong></p>

<p>只有模块(module)，类(class)，函数(def, lambda)会产生新的命名空间，其他如流程控制的代码块(if, for, try等)不会产生新命名空间。产生新命名空间意味着外部无法访问新命名空间内定义的变量</p>

<p>从外到内分为4种命名空间：</p>

<ol>
  <li>
<strong>B</strong>uilt-in(内建)：python自带的变量</li>
  <li>
<strong>G</strong>lobal or module(全局)</li>
  <li>
<strong>E</strong>nclosing or nonlocal(闭包)：既不是全局也不是局部，通常出现在闭包语境下</li>
  <li>
<strong>L</strong>ocal or function(局部)</li>
</ol>

<p>查找一个名字是否可用的顺序是：L-&gt;E-&gt;G-&gt;B(<a href="https://realpython.com/python-scope-legb-rule/#using-the-legb-rule-for-python-scope"><strong>LEGB rule</strong></a>)，区域由内到外</p>

<h2 id="global--nonlocal">global &amp; nonlocal</h2>

<p>改变默认的LEGB规则：在内部空间使用，指定访问哪个命名空间的名字，同时赋予修改权限（允许修改外部变量）</p>

<p>内部作用域虽然可以自由<strong>访问</strong>外部作用域的变量值，却无法直接<strong>修改</strong></p>

<p>想在内部作用域<strong>修改</strong>外部作用域的变量时，就需要用<code class="language-plaintext highlighter-rouge">global</code>和<code class="language-plaintext highlighter-rouge">nonlocal</code>关键字声明一下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gv</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># 全局变量--不可变数据类型
</span><span class="n">gvs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 全局变量--可变数据类型
</span><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">gv</span>
    <span class="n">gv</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">gvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">global</span> <span class="n">lazy_gv</span>
    <span class="n">lazy_gv</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">nlv</span> <span class="o">=</span> <span class="mi">11</span>     <span class="c1"># 非局部变量--不可变数据类型
</span>    <span class="n">nlvs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">]</span>  <span class="c1"># 非局部变量--可变数据类型
</span>    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">nlv</span>
        <span class="n">nlv</span> <span class="o">+=</span> <span class="mi">22</span>
        <span class="n">nlvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">22</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">nlv</span><span class="p">,</span> <span class="n">nlvs</span><span class="p">)</span>  <span class="c1"># 11 [11]
</span>    <span class="nf">inner</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">nlv</span><span class="p">,</span> <span class="n">nlvs</span><span class="p">)</span>  <span class="c1"># 33 [33]
</span>
<span class="nf">print</span><span class="p">(</span><span class="n">gv</span><span class="p">,</span> <span class="n">gvs</span><span class="p">,</span> <span class="p">(</span><span class="s">'lazy_gv'</span> <span class="ow">in</span> <span class="nf">globals</span><span class="p">()))</span>  <span class="c1"># 1 [1] False
</span><span class="nf">outer</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">gv</span><span class="p">,</span> <span class="n">gvs</span><span class="p">,</span> <span class="p">(</span><span class="s">'lazy_gv'</span> <span class="ow">in</span> <span class="nf">globals</span><span class="p">()))</span>  <span class="c1"># 3 [3] True
</span></code></pre></div></div>

<p>对于可变数据类型，由于没有修改容器本身（容器本身的 <code class="language-plaintext highlighter-rouge">id</code>没变），所以不声明也能修改容器内的值</p>

<h2 id="获取指定作用域内的变量">获取指定作用域内的变量：</h2>

<p><code class="language-plaintext highlighter-rouge">globals()</code>：获取所有全局变量，还可以修改变量值（<em>字典</em>）</p>

<p><code class="language-plaintext highlighter-rouge">locals()</code>：在函数内调用时，获取函数内所有局部变量（<em>字典</em>）</p>

<p><code class="language-plaintext highlighter-rouge">vars([object])</code>：返回<code class="language-plaintext highlighter-rouge">object</code>的<code class="language-plaintext highlighter-rouge">__dict__</code>属性（<em>字典</em>），不传参数返回<code class="language-plaintext highlighter-rouge">locals()</code></p>

<p><code class="language-plaintext highlighter-rouge">dir([object])</code>：返回<code class="language-plaintext highlighter-rouge">object</code>命名空间中的名字（<em>列表</em>），<code class="language-plaintext highlighter-rouge">"__dict__"</code>是其中之一；不传参数返回<strong>当前命名空间</strong>中的名字（<em>列表</em>）</p>

<p><code class="language-plaintext highlighter-rouge">__dict__</code>：存放对象的<strong>可写属性</strong>，可以通过该字典修改对象属性</p>

<h1 id="总结">总结</h1>

<p>内部命名空间可以访问外部命名空间的名字，但不能修改，要修改需要加<code class="language-plaintext highlighter-rouge">global</code>或<code class="language-plaintext highlighter-rouge">nonlocal</code></p>

<p>外部空间不能访问内部变量</p>

<p><a href="https://realpython.com/python-scope-legb-rule/">Python Scope &amp; the LEGB Rule: Resolving Names in Your Code – Real Python</a></p>

<p><a href="https://realpython.com/python-namespaces-scope/">Namespaces and Scope in Python – Real Python</a></p>

<p><a href="https://www.runoob.com/python3/python3-namespace-scope.html">Python3 命名空间和作用域 – runoob</a></p>

</div>
    </div>
    <script>
      const ct = document.querySelector('.post_content');  //".post-content"指向文章内容所在的div，需根据实际情况修改
      scrollnav.init(ct, {
          debug: false,
          easingStyle: 'linear',
          //section为一级目录，subsection为二级目录
          sections: ($('.post_content > h1').length>0) ? 'h1' : 'h2',
          subSections: ($('.post_content > h1').length>0) ? 'h2' : 'h3',
      });
    </script>
    <script type="text/javascript">
      $('pre').addClass("line-numbers").css("white-space", "pre-wrap");
    </script>
  </body>
</html>
