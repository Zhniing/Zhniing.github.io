---
last-updated-date: 2021-09-14 22:41:23 +0800
---

# 网络协议

## 协议栈 Protocol Stack

![Protocol Stack](https://img-blog.csdn.net/20161116144744393)

**TCP**和**UDP**都为**传输层**协议

## TCP

### 三次握手

用于建立TCP连接

![TCP](https://res-static.hc-cdn.cn/fms/img/0c6f5dc04e337b1c6deb57e82a9210d71603427626959)

报文格式

![TCP Message Format](https://img-blog.csdn.net/20140609125220296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYTE5ODgxMDI5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

标志位：

- SYN：0/1
- ACK：0/1，传输数据过程中，ACK始终为1

序号：

- seq（**序号**）：占4个字节，每一个字节按照顺序编号，循环使用
- ack（**确认**序**号**）

### 第三次握手

意义在于：如果第一次握手的报文，长时间滞留在某些网络节点上，导致过了很久才到达服务器，那么这个报文实际上是一个过期报文，不应该建立连接。但是服务器不知道，还是会做第二次握手，这时客户端知道自己没有发起请求，所以不会做第三次握手，TCP连接也不会被建立。从而避免了建立过期报文的连接。

### 缺陷

服务端收到SYN报文（第一次握手）时，就会立即创建一个*传输控制模块*（TCB），占用相应系统资源，这一特性也被用来对服务器进行攻击：

**SYN Flood**，即拒绝服务攻击，通过向服务器发送大量伪造源地址的请求报文（第一次握手），服务器就会对这些源地址进行第二次握，由于收不到第三次握手，就会反复进行多次（tcp_syn_retries=5次），堆积大量**半开连接**，从而消耗大量内存和带宽，导致无法处理正常的请求。

**SYN Caches**，通过延迟分配TCB，来应对**SYN Flood**。进行第二次握手后，将这个**半开连接**存入一个专用Hash表，等到完成第三次握手后，再分配TCB，从而避免了系统资源被持续消耗。

### 长肥网络 Long Fat Network(LFN)

LFN，指长距离广域网、高带宽的网络环境

TCP协议设置了许多保证数据*可靠传输*的**效验**，这在低俗实验室环境下没有问题，但在远距离传输上，就会造成明显的**延迟**（**几百毫秒**）

## 参考

[TCP三次握手和四次挥手以及缺陷](https://www.jianshu.com/p/062a727862e9)

[补牢TCP/IP——适应长肥网络环境（上）](https://searchnetworking.techtarget.com.cn/12-15723/)

# 进程和现程